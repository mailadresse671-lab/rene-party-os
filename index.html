<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ren√© OS - Global Party v7</title>
    <link href="https://fonts.googleapis.com/css2?family=Bangers&family=VT323&family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/gun/gun.js"></script>
    <style>
        :root {
            --neon-blue: #00f2ea;
            --neon-pink: #ff0050;
            --bg-dark: #020617;
            --pad-off: #1e293b;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; user-select: none; -webkit-tap-highlight-color: transparent; }
        body { background-color: var(--bg-dark); color: white; font-family: 'Inter', sans-serif; height: 100vh; overflow: hidden; display: flex; flex-direction: column; }
        .hidden { display: none !important; }
        .full-screen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 10; overflow: hidden; }
        .scrollable { overflow-y: auto; -webkit-overflow-scrolling: touch; }

        /* INTRO & LOGIN Styles (kompakt) */
        #video-layer { position: fixed; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; z-index: 1; opacity: 0.4; filter: contrast(1.2) brightness(0.8) hue-rotate(180deg); }
        #view-intro { background: #000; display: flex; align-items: center; justify-content: center; z-index: 2000; }
        #terminal-layer { position: absolute; z-index: 2; padding: 20px; font-family: 'VT323', monospace; color: #0f0; font-size: 1.5rem; text-shadow: 0 0 5px #0f0; bottom: 15%; width: 100%; pointer-events: none; }
        .terminal-line { margin-bottom: 5px; opacity: 0; animation: fadeIn 0.1s forwards; }
        @keyframes fadeIn { to { opacity: 1; } }
        #start-btn { z-index: 10; padding: 15px 30px; font-family: 'Bangers'; font-size: 1.8rem; background: var(--neon-pink); color: white; border: none; border-radius: 10px; animation: pulse 1.5s infinite; cursor: pointer; }
        #skip-btn { position: absolute; top: 20px; right: 20px; z-index: 20; background: rgba(0,0,0,0.5); border: 1px solid white; color: white; padding: 5px 12px; border-radius: 20px; font-size: 0.8rem; cursor: pointer; display: none; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        #view-login { z-index: 100; display: flex; flex-direction: column; align-items: center; justify-content: center; background: radial-gradient(circle, #1e293b 0%, #020617 100%); }
        .login-box { background: #0f172a; padding: 2rem; border-radius: 1rem; border: 1px solid var(--neon-blue); text-align: center; width: 85%; max-width: 350px; }
        .input-field { width: 100%; padding: 12px; margin: 15px 0; background: #020617; border: 1px solid #334155; color: white; text-align: center; font-size: 1.1rem; border-radius: 8px; }
        .btn-main { width: 100%; padding: 12px; background: var(--neon-blue); color: black; font-family: 'Bangers'; font-size: 1.4rem; border-radius: 8px; border:none; }

        /* UI HEADER & DASH */
        .app-header { height: 60px; display: flex; align-items: center; justify-content: space-between; padding: 0 15px; background: rgba(2,6,23,0.95); border-bottom: 1px solid #333; position: sticky; top: 0; z-index: 50; }
        .back-btn { background: none; color: white; font-size: 1.5rem; border: none; padding: 10px; }
        .title { font-family: 'Bangers'; font-size: 1.5rem; letter-spacing: 1px; }
        .dash-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 15px; max-width: 600px; margin: 0 auto; }
        .app-icon { background: #0f172a; border: 1px solid #333; padding: 15px; border-radius: 15px; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; gap: 10px; text-align: center; height: 140px;}
        .icon-emoji { font-size: 2.5rem; }

        /* SNAKE LEADERBOARD */
        #snake-leaderboard { margin-top: 20px; padding: 10px; width: 100%; max-width: 300px; background: #111; border-radius: 10px; border: 1px solid #333; }
        .score-entry { display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px solid #222; font-size: 0.9rem; }
        .score-entry:first-child { color: var(--neon-blue); font-weight: bold; font-size: 1rem; }

        /* ToD FEED STYLES */
        .tod-card { background: #1e293b; margin: 15px; padding: 20px; border-radius: 15px; text-align: center; border: 1px solid #444; }
        .tod-feed { padding: 15px; padding-bottom: 100px; }
        .feed-item { background: #0f172a; border: 1px solid #333; border-radius: 10px; padding: 15px; margin-bottom: 10px; animation: fadeIn 0.3s; }
        .feed-header { font-size: 0.8rem; color: #aaa; margin-bottom: 5px; display: flex; justify-content: space-between;}
        .feed-question { font-weight: bold; color: var(--neon-blue); margin-bottom: 5px; font-style: italic;}
        .feed-answer { font-size: 1.1rem; color: white; margin-top: 5px; padding-top: 5px; border-top: 1px dashed #333; }
        .feed-badge { padding: 2px 6px; border-radius: 4px; font-size: 0.7rem; font-weight: bold; }
        .badge-w { background: var(--neon-blue); color: black; }
        .badge-p { background: var(--neon-pink); color: white; }

        /* CHAT & GENERAL LISTS */
        #chat-list { flex: 1; overflow-y: auto; padding: 10px; display: flex; flex-direction: column; gap: 8px; padding-bottom: 70px; }
        .msg { padding: 8px 12px; border-radius: 12px; max-width: 85%; font-size: 0.9rem; word-wrap: break-word;}
        .mine { align-self: flex-end; background: var(--neon-blue); color: black; }
        .others { align-self: flex-start; background: #334155; }
        .chat-input-area { position: fixed; bottom: 0; width: 100%; padding: 10px; background: var(--bg-dark); display: flex; gap: 8px; border-top: 1px solid #333; }
        
        /* Studio & Art (Compact) */
        .dj-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; padding: 10px; max-height: 60vh; }
        .pad { aspect-ratio: 1; background: var(--pad-off); border: 2px solid #334155; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; }
        .pad:active { background: #334155; border-color: white; transform: scale(0.95); }
        .p-kick { border-bottom: 3px solid #ff0050; } .p-snare { border-bottom: 3px solid #00f2ea; } .p-bass { border-bottom: 3px solid #ffee00; }
        #gallery-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; padding: 10px; overflow-y: auto; padding-bottom: 100px;}
        .gallery-img { width: 100%; aspect-ratio: 1; object-fit: cover; border-radius: 4px; border: 1px solid #333; }
    </style>
</head>
<body>

    <audio id="intro-music" src="intro-sound.mp3" preload="auto"></audio>

    <div id="view-intro" class="full-screen">
        <video id="video-layer" muted playsinline></video>
        <div id="terminal-layer"></div>
        <button id="start-btn" onclick="app.startShow()">TAP TO START üöÄ</button>
        <button id="skip-btn" onclick="app.endIntro()">SKIP ‚è©</button>
    </div>

    <div id="view-login" class="full-screen hidden">
        <div class="login-box">
            <h1 style="font-family: 'Bangers'; font-size: 2.5rem; margin-bottom: 5px;">REN√â OS <span style="color:var(--neon-pink)">v7.0</span></h1>
            <p style="margin-bottom:15px; opacity:0.7; font-size:0.9rem;">Global Party Edition</p>
            <input type="text" id="username" class="input-field" placeholder="Dein Name..." maxlength="12">
            <button class="btn-main" onclick="app.login()">EINTRETEN üåç</button>
        </div>
    </div>

    <div id="view-dash" class="full-screen hidden scrollable">
        <div style="text-align: center; margin-top: 30px; margin-bottom: 20px;">
            <h2 style="font-family: 'Bangers'; letter-spacing: 1px;">STATUS: <span style="color:#0f0">CONNECTED</span></h2>
            <p style="font-size: 0.9rem;">User: <span id="display-name" style="color:var(--neon-blue); font-weight:bold;">GAST</span></p>
        </div>
        <div class="dash-grid">
            <div class="app-icon" onclick="app.nav('chat')"><div class="icon-emoji">üí¨</div><div class="icon-title">Chat</div></div>
            <div class="app-icon" onclick="app.nav('tod')"><div class="icon-emoji">üé≤</div><div class="icon-title">Wahrheit/Pflicht</div></div>
            <div class="app-icon" onclick="app.nav('snake')"><div class="icon-emoji">üêç</div><div class="icon-title">Snake Liga</div></div>
            <div class="app-icon" onclick="app.nav('dj')"><div class="icon-emoji">üéõÔ∏è</div><div class="icon-title">Studio</div></div>
            <div class="app-icon" onclick="app.nav('art')"><div class="icon-emoji">üé®</div><div class="icon-title">Picasso</div></div>
        </div>
    </div>

    <div id="view-chat" class="full-screen hidden">
        <div class="app-header"><button class="back-btn" onclick="app.nav('dash')">‚¨ÖÔ∏è</button><div class="title">CHAT</div><div style="width:40px"></div></div>
        <div id="chat-list"></div>
        <div class="chat-input-area">
            <input type="text" id="chat-msg" style="flex:1; padding:10px; border-radius:20px; border:none;" placeholder="...">
            <button onclick="app.chat.send()" style="background:var(--neon-pink); width:40px; height:40px; border-radius:50%; border:none;">‚û§</button>
        </div>
    </div>

    <div id="view-tod" class="full-screen hidden scrollable">
        <div class="app-header"><button class="back-btn" onclick="app.nav('dash')">‚¨ÖÔ∏è</button><div class="title">PARTY FEED</div><div style="width:40px"></div></div>
        
        <div class="tod-card">
            <h3 style="margin-bottom:10px;">Zieh eine Karte!</h3>
            <div id="tod-active-area" style="display:none;">
                <div id="tod-type-badge" class="feed-badge badge-w" style="font-size:1.2rem; display:inline-block; margin-bottom:10px;">WAHRHEIT</div>
                <div id="tod-question" style="font-size:1.2rem; font-weight:bold; margin-bottom:15px;">Frage...</div>
                <input type="text" id="tod-answer-input" class="input-field" placeholder="Deine Antwort / Beweis..." style="margin: 10px 0;">
                <button onclick="app.tod.post()" class="btn-main" style="font-size:1rem; padding:10px;">ANTWORT POSTEN üìù</button>
            </div>
            
            <div id="tod-buttons" style="display:flex; gap:10px; justify-content:center;">
                <button onclick="app.tod.spin('wahrheit')" style="padding:15px; background:var(--neon-blue); border:none; border-radius:10px; flex:1; font-weight:bold;">WAHRHEIT</button>
                <button onclick="app.tod.spin('pflicht')" style="padding:15px; background:var(--neon-pink); border:none; border-radius:10px; flex:1; font-weight:bold; color:white;">PFLICHT</button>
            </div>
        </div>

        <h4 style="margin-left:15px; color:#aaa;">FEED (Was die anderen sagen):</h4>
        <div id="tod-feed" class="tod-feed">
            </div>
    </div>

    <div id="view-snake" class="full-screen hidden" style="background:#000; overflow-y:auto;">
        <div class="app-header"><button class="back-btn" onclick="app.nav('dash'); app.snake.stop();">‚¨ÖÔ∏è</button><div class="title">SNAKE LIGA</div><div style="width:40px"></div></div>
        <div style="display:flex; flex-direction:column; align-items:center; padding:10px;">
            <div>Score: <span id="snake-score" style="color:var(--neon-pink)">0</span></div>
            <canvas id="snake-canvas" width="300" height="300" style="background:#111; border:2px solid var(--neon-blue); margin:10px 0;"></canvas>
            
            <button onclick="app.snake.start()" style="margin-bottom:15px; padding: 10px 30px; background:var(--neon-blue); border:none; border-radius:5px; font-weight:bold;">START GAME</button>
            
            <div class="game-controls" style="display:flex; gap:15px; margin-bottom:20px;">
                <button style="width:50px; height:50px; background:#333; border-radius:50%; color:white; border:none;" onclick="app.snake.dir('left')">‚¨ÖÔ∏è</button>
                <div style="display:flex; flex-direction:column; gap:10px;">
                    <button style="width:50px; height:50px; background:#333; border-radius:50%; color:white; border:none;" onclick="app.snake.dir('up')">‚¨ÜÔ∏è</button>
                    <button style="width:50px; height:50px; background:#333; border-radius:50%; color:white; border:none;" onclick="app.snake.dir('down')">‚¨áÔ∏è</button>
                </div>
                <button style="width:50px; height:50px; background:#333; border-radius:50%; color:white; border:none;" onclick="app.snake.dir('right')">‚û°Ô∏è</button>
            </div>

            <h3 style="color:var(--neon-pink)">üèÜ WELTRANGLISTE üèÜ</h3>
            <div id="snake-leaderboard">Loading...</div>
        </div>
    </div>

    <div id="view-dj" class="full-screen hidden" style="display:flex; flex-direction:column;">
        <div class="app-header"><button class="back-btn" onclick="app.nav('dash')">‚¨ÖÔ∏è</button><div class="title">STUDIO</div><div style="width:40px"></div></div>
        <div class="dj-grid">
            <div class="pad p-kick" onclick="app.studio.hit('kick')">ü•Å</div><div class="pad p-snare" onclick="app.studio.hit('snare')">üëè</div><div class="pad p-snare" onclick="app.studio.hit('hat')">üêç</div>
            <div class="pad p-bass" onclick="app.studio.hit('bass1')">A1</div><div class="pad p-bass" onclick="app.studio.hit('bass2')">C2</div><div class="pad p-bass" onclick="app.studio.hit('bass3')">D2</div>
            <div class="pad p-kick" onclick="app.studio.hit('laser')">üî´</div><div class="pad p-snare" onclick="app.studio.hit('horn')">üì¢</div><div class="pad p-bass" onclick="app.studio.hit('yeah')">üó£Ô∏è</div>
        </div>
        <div style="padding:10px; text-align:center; color:#aaa; font-size:0.8rem;">Jeder Beat wird live √ºbertragen!</div>
    </div>

    <div id="view-art" class="full-screen hidden" style="display:flex; flex-direction:column;">
        <div class="app-header"><button class="back-btn" onclick="app.nav('dash')">‚¨ÖÔ∏è</button><div class="title">ART</div><button onclick="app.art.clear()" style="font-size:0.8rem; background:none; color:red; border:none;">Clear</button></div>
        <div style="padding:10px; text-align:center; background:#222;">
            <canvas id="canvas" style="background:white; border-radius:8px; width:100%; height:300px; touch-action:none;"></canvas>
            <br><button onclick="app.art.save()" style="margin-top:10px; background:var(--neon-blue); padding:10px 30px; border-radius:20px; font-weight:bold; border:none;">POSTEN</button>
        </div>
        <div id="gallery-grid"></div>
    </div>

    <script>
        const videos = ['glitch1.mp4', 'glitch2.mp4', 'glitch3.mp4']; 
        // GLOBAL SYNC DATABASE
        const gun = Gun(['https://gun-manhattan.herokuapp.com/gun']);
        const db = gun.get('rene-party-v7-global'); 

        const app = {
            user: localStorage.getItem('user') || '',
            isIntroRunning: false,
            
            init: () => {
                if(app.user) {
                    document.getElementById('username').value = app.user;
                    document.getElementById('display-name').innerText = app.user;
                }
                app.chat.listen(); 
                app.art.listen();
                app.snake.listenScores();
                app.tod.listenFeed();
            },
            startShow: () => {
                document.getElementById('start-btn').style.display = 'none';
                document.getElementById('skip-btn').style.display = 'block';
                app.isIntroRunning = true;
                const audio = document.getElementById('intro-music');
                audio.volume = 1.0; audio.play().catch(e => console.log("Audio Error"));
                const vidEl = document.getElementById('video-layer');
                let vidIdx = 0;
                function playNextVideo() { if(!app.isIntroRunning) return; vidEl.src = videos[vidIdx]; vidEl.play(); vidIdx = (vidIdx + 1) % videos.length; }
                vidEl.onended = playNextVideo; playNextVideo();
                app.typeWriter();
            },
            endIntro: () => {
                app.isIntroRunning = false;
                const audio = document.getElementById('intro-music'); audio.pause(); audio.currentTime = 0;
                document.getElementById('view-intro').classList.add('hidden');
                document.getElementById('view-login').classList.remove('hidden');
            },
            typeWriter: () => {
                const lines = ["> Global Connection... OK", "> Multiplayer Sync... OK", "> Social Feed... OK", "> Happy Birthday Ren√©!", "> Have Fun!"];
                let i = 0; const terminal = document.getElementById('terminal-layer');
                function nextLine() {
                    if (!app.isIntroRunning) return;
                    if (i < lines.length) {
                        const div = document.createElement('div'); div.className = 'terminal-line'; div.innerText = lines[i];
                        terminal.appendChild(div); terminal.scrollTop = terminal.scrollHeight; i++;
                        setTimeout(nextLine, 1500); 
                    } else { setTimeout(() => { if(app.isIntroRunning) app.endIntro(); }, 1500); }
                }
                nextLine();
            },
            login: () => {
                const name = document.getElementById('username').value.trim();
                if(!name) return alert("Name fehlt!");
                app.user = name; localStorage.setItem('user', name);
                document.getElementById('display-name').innerText = name;
                app.nav('dash');
            },
            nav: (view) => {
                document.querySelectorAll('.full-screen').forEach(el => el.classList.add('hidden'));
                if(view === 'intro') return; 
                document.getElementById('view-' + view).classList.remove('hidden');
            },

            // --- CHAT ---
            chat: {
                send: () => {
                    const txt = document.getElementById('chat-msg').value; if(!txt) return;
                    db.get('chat').set({ text: txt, author: app.user, time: Date.now() }); document.getElementById('chat-msg').value = '';
                },
                listen: () => {
                    db.get('chat').map().once((data, id) => {
                        if(!data || document.getElementById(id)) return;
                        const div = document.createElement('div'); div.id = id; div.className = `msg ${data.author === app.user ? 'mine' : 'others'}`;
                        div.innerHTML = `<b>${data.author}:</b> ${data.text}`;
                        const list = document.getElementById('chat-list'); list.appendChild(div); list.scrollTop = list.scrollHeight;
                    });
                }
            },

            // --- WAHRHEIT ODER PFLICHT (FEED) ---
            tod: {
                currentQ: "",
                currentType: "",
                truths: ["Wann hast du das letzte Mal gelogen?", "Wer ist dein Lieblingscousin?", "Was ist dein peinlichstes Foto?", "W√ºrdest du f√ºr 1 Mio auf Internet verzichten?", "Was nervt dich an DoN am meisten?", "Welches Geheimnis kennt niemand?"],
                dares: ["Mach 10 Liegest√ºtze und poste ein Foto!", "Sing ein Lied f√ºr Ren√© (Video)!", "Zeig dein letztes Foto im Handy!", "Mach einen Moonwalk!", "Lass dich 30sek kitzeln!"],
                
                spin: (type) => {
                    const list = type === 'wahrheit' ? app.tod.truths : app.tod.dares;
                    app.tod.currentQ = list[Math.floor(Math.random() * list.length)];
                    app.tod.currentType = type;
                    
                    document.getElementById('tod-buttons').style.display = 'none';
                    document.getElementById('tod-active-area').style.display = 'block';
                    
                    const badge = document.getElementById('tod-type-badge');
                    badge.innerText = type.toUpperCase();
                    badge.className = `feed-badge ${type==='wahrheit'?'badge-w':'badge-p'}`;
                    document.getElementById('tod-question').innerText = app.tod.currentQ;
                    document.getElementById('tod-answer-input').value = "";
                },
                post: () => {
                    const ans = document.getElementById('tod-answer-input').value;
                    if(!ans) return alert("Schreib eine Antwort oder 'Erledigt'!");
                    
                    // Save to cloud
                    db.get('tod-feed').set({
                        author: app.user,
                        type: app.tod.currentType,
                        question: app.tod.currentQ,
                        answer: ans,
                        time: Date.now()
                    });

                    // Reset UI
                    document.getElementById('tod-active-area').style.display = 'none';
                    document.getElementById('tod-buttons').style.display = 'flex';
                },
                listenFeed: () => {
                    db.get('tod-feed').map().once((data, id) => {
                        if(!data || document.getElementById(id)) return;
                        const div = document.createElement('div');
                        div.id = id; div.className = 'feed-item';
                        div.innerHTML = `
                            <div class="feed-header">
                                <span>${data.author}</span>
                                <span class="feed-badge ${data.type==='wahrheit'?'badge-w':'badge-p'}">${data.type.toUpperCase()}</span>
                            </div>
                            <div class="feed-question">${data.question}</div>
                            <div class="feed-answer">${data.answer}</div>
                        `;
                        document.getElementById('tod-feed').prepend(div);
                    });
                }
            },

            // --- SNAKE (LEADERBOARD) ---
            snake: {
                gameLoop: null, snake: [], food: {}, dir: 'right', score: 0,
                allScores: [], // Local cache for sorting
                start: () => {
                    if(app.snake.gameLoop) clearInterval(app.snake.gameLoop);
                    app.snake.snake = [{x:10, y:10}, {x:9, y:10}, {x:8, y:10}];
                    app.snake.food = {x:15, y:15}; app.snake.dir = 'right'; app.snake.score = 0;
                    document.getElementById('snake-score').innerText = 0;
                    app.snake.gameLoop = setInterval(app.snake.update, 150);
                },
                stop: () => { 
                    if(app.snake.gameLoop) {
                        clearInterval(app.snake.gameLoop);
                        app.snake.gameLoop = null;
                        if(app.snake.score > 0) {
                            const date = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                            db.get('snake-scores').set({
                                name: app.user,
                                score: app.snake.score,
                                date: date
                            });
                            alert("Game Over! Score gespeichert.");
                        }
                    }
                },
                dir: (d) => {
                    const cur = app.snake.dir;
                    if(d=='left' && cur!='right') app.snake.dir = 'left';
                    if(d=='right' && cur!='left') app.snake.dir = 'right';
                    if(d=='up' && cur!='down') app.snake.dir = 'up';
                    if(d=='down' && cur!='up') app.snake.dir = 'down';
                },
                update: () => {
                    const cvs = document.getElementById('snake-canvas'); const ctx = cvs.getContext('2d');
                    const cw = cvs.width/20; const ch = cvs.height/20;
                    let head = {x: app.snake.snake[0].x, y: app.snake.snake[0].y};
                    if(app.snake.dir == 'right') head.x++; else if(app.snake.dir == 'left') head.x--;
                    else if(app.snake.dir == 'up') head.y--; else if(app.snake.dir == 'down') head.y++;
                    
                    if(head.x < 0 || head.x >= 20 || head.y < 0 || head.y >= 20 || app.snake.snake.some(s => s.x == head.x && s.y == head.y)) {
                        app.snake.stop(); return;
                    }
                    app.snake.snake.unshift(head);
                    if(head.x == app.snake.food.x && head.y == app.snake.food.y) {
                        app.snake.score++; document.getElementById('snake-score').innerText = app.snake.score;
                        app.snake.food = {x: Math.floor(Math.random()*20), y: Math.floor(Math.random()*20)};
                    } else { app.snake.snake.pop(); }
                    
                    ctx.fillStyle = '#111'; ctx.fillRect(0,0,300,300);
                    ctx.fillStyle = '#0f0'; app.snake.snake.forEach(s => ctx.fillRect(s.x*15, s.y*15, 14, 14));
                    ctx.fillStyle = '#f00'; ctx.fillRect(app.snake.food.x*15, app.snake.food.y*15, 14, 14);
                },
                listenScores: () => {
                    db.get('snake-scores').map().once((data, id) => {
                        if(!data) return;
                        app.snake.allScores.push(data);
                        // Sortieren und Anzeigen
                        app.snake.allScores.sort((a, b) => b.score - a.score);
                        const top10 = app.snake.allScores.slice(0, 10);
                        
                        let html = '';
                        top10.forEach((s, i) => {
                            html += `<div class="score-entry"><span>#${i+1} ${s.name}</span><span>${s.score} Pkt</span></div>`;
                        });
                        document.getElementById('snake-leaderboard').innerHTML = html;
                    });
                }
            },

            // --- STUDIO & ART (Simple) ---
            studio: {
                hit: (sound) => { 
                    const AudioContext = window.AudioContext || window.webkitAudioContext;
                    const ctx = new AudioContext();
                    const osc = ctx.createOscillator(); const g = ctx.createGain();
                    osc.connect(g); g.connect(ctx.destination);
                    if(sound.includes('bass')) osc.type='sawtooth'; else osc.type='sine';
                    osc.frequency.value = 200 + Math.random()*200;
                    osc.start(); osc.stop(ctx.currentTime+0.2);
                }
            },
            art: {
                canvas: document.getElementById('canvas'), ctx: document.getElementById('canvas').getContext('2d'), isDrawing: false,
                setup: () => {
                    const c = app.art.canvas; const ctx = app.art.ctx;
                    c.width = c.offsetWidth; c.height = c.offsetHeight;
                    const getPos = (e) => { const r = c.getBoundingClientRect(); return { x: (e.touches?e.touches[0].clientX:e.clientX)-r.left, y: (e.touches?e.touches[0].clientY:e.clientY)-r.top }; };
                    const start = () => { app.art.isDrawing = true; ctx.beginPath(); }; const end = () => app.art.isDrawing = false;
                    const draw = (e) => { if(!app.art.isDrawing) return; e.preventDefault(); const p = getPos(e); ctx.lineWidth=3; ctx.lineCap='round'; ctx.lineTo(p.x, p.y); ctx.stroke(); };
                    c.addEventListener('mousedown', start); c.addEventListener('mousemove', draw); c.addEventListener('mouseup', end);
                    c.addEventListener('touchstart', start); c.addEventListener('touchmove', draw); c.addEventListener('touchend', end);
                },
                clear: () => { const c = app.art.canvas; app.art.ctx.clearRect(0,0,c.width,c.height); },
                save: () => { const d = app.art.canvas.toDataURL('image/jpeg', 0.5); db.get('gallery').set({ img: d, author: app.user }); app.art.clear(); alert("Gesendet!"); },
                listen: () => { db.get('gallery').map().once((data, id) => { if(!data || document.getElementById(id)) return; const i = document.createElement('img'); i.src = data.img; i.className = 'gallery-img'; i.id = id; document.getElementById('gallery-grid').prepend(i); }); }
            }
        };
        app.art.setup(); app.init();
    </script>
</body>
</html>
